<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InspireMe - Pomodoro Timer</title>
    <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>
    <div class="container">
        <h1>InspireMe - Pomodoro Timer</h1>

        <!-- Timer section -->
        <div class="timer">
            <p>Work Session: <input id="work-duration" type="number" value="25" min="1" max="60"> minutes</p>
            <p>Break Session: <input id="break-duration" type="number" value="5" min="1" max="30"> minutes</p>
            <p>Time Left: <span id="countdown">--:--</span></p>
        </div>

        <!-- Inspirational quote -->
        <div class="quote-box">
            <h3>Motivational Quote</h3>
            <p>"<%= currentQuote %>"</p>
        </div>

        <!-- Start Pomodoro / Cancel button -->
        <button id="startPomodoro">Start Pomodoro</button>

        <!-- Button to confirm starting the next session, hidden by default -->
        <button id="nextSessionButton" style="display: none;">Start Next Session</button>

        <!-- Pause/Resume button, hidden by default -->
        <button id="pauseButton" style="display: none;">Pause</button>
    </div>

    <script>
        // Get elements from the DOM
        const countdownDisplay = document.getElementById("countdown");
        const startPomodoroButton = document.getElementById("startPomodoro");
        const nextSessionButton = document.getElementById("nextSessionButton");
        const pauseButton = document.getElementById("pauseButton");
        const workDurationInput = document.getElementById("work-duration");
        const breakDurationInput = document.getElementById("break-duration");

        let isRunning = false;
        let isBreak = false; // Track if it's a break or work session
        let isPaused = false; // Track if the timer is paused
        let timer;
        let timeLeft; // Store the time left

        // Function to start the countdown
        function startCountdown(duration) {
            timeLeft = duration;
            pauseButton.style.display = "inline"; // Show the Pause button
            nextSessionButton.style.display = "none"; // Hide the Next Session button
            startPomodoroButton.textContent = "Cancel"; // Change Start button to Cancel
            isRunning = true; // Mark as running

            timer = setInterval(() => {
                if (!isPaused) {
                    let minutes = Math.floor(timeLeft / 60);
                    let seconds = timeLeft % 60;

                    // Format time display
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    // Update the countdown display
                    countdownDisplay.textContent = `${minutes}:${seconds}`;

                    // Decrement time
                    timeLeft--;

                    // When the timer reaches 0, stop and show the button to start the next session
                    if (timeLeft < 0) {
                        clearInterval(timer);

                        if (isBreak) {
                            alert("Break over! Click 'Start Next Session' to begin your next work session.");
                            nextSessionButton.textContent = "Start Work Session";
                        } else {
                            alert("Work session over! Click 'Start Next Session' to begin your break.");
                            nextSessionButton.textContent = "Start Break Session";
                        }

                        nextSessionButton.style.display = "inline"; // Show the Next Session button
                        pauseButton.style.display = "none"; // Hide the Pause button
                        startPomodoroButton.textContent = "Start Pomodoro"; // Change back to Start Pomodoro
                        isRunning = false; // Reset running state
                    }
                }
            }, 1000);
        }

        // Function to confirm starting the next session (work or break)
        function confirmNextSession() {
            if (isBreak) {
                isBreak = false; // Switch back to work session
                let workDuration = parseInt(workDurationInput.value) * 60; // Convert to seconds
                startCountdown(workDuration); // Start the next work session
            } else {
                isBreak = true; // Switch to break session
                let breakDuration = parseInt(breakDurationInput.value) * 60; // Convert to seconds
                startCountdown(breakDuration); // Start the break session
            }

            nextSessionButton.style.display = "none"; // Hide the button after starting the session
        }

        // Event listener to start or cancel the Pomodoro when button is clicked
        startPomodoroButton.addEventListener("click", () => {
            if (isRunning) {
                // If it's running, cancel the current session
                clearInterval(timer); // Stop the timer
                countdownDisplay.textContent = "--:--"; // Reset the countdown display
                startPomodoroButton.textContent = "Start Pomodoro"; // Change back to Start Pomodoro
                pauseButton.style.display = "none"; // Hide Pause button
                isRunning = false; // Mark as not running
                isPaused = false; // Reset pause state
                pauseButton.textContent = "Pause"; // Reset Pause button text
            } else {
                // If it's not running, start the Pomodoro session
                let workDuration = parseInt(workDurationInput.value) * 60; // Convert to seconds
                startCountdown(workDuration);
            }
        });

        // Event listener to start the next session when the user clicks the button
        nextSessionButton.addEventListener("click", confirmNextSession);

        // Event listener for Pause/Resume functionality
        pauseButton.addEventListener("click", () => {
            if (isPaused) {
                pauseButton.textContent = "Pause"; // Change to "Pause"
                isPaused = false; // Resume the countdown
            } else {
                pauseButton.textContent = "Resume"; // Change to "Resume"
                isPaused = true; // Pause the countdown
            }
        }) ; 
    </script>
</body>
</html>
